<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionario Report QlikView → Power BI | Goline IT Services</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --goline-teal:    #0d95a8;
            --goline-accent:  #00b4cc;
            --goline-dark:    #1e293b;
            --goline-light:   #f8fafc;
            --error:          #ef4444;
            --success:        #10b981;
            --warning:        #f59e0b;
            --gray:           #64748b;
            --border:         #e2e8f0;
            --shadow-sm:      0 2px 8px rgba(13,149,168,0.08);
            --shadow-md:      0 8px 24px rgba(13,149,168,0.12);
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Outfit', system-ui, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e8f4f6 100%);
            color: var(--goline-dark);
            min-height: 100vh;
            padding: 2rem 1rem;
            line-height: 1.5;
        }

        .container { max-width: 820px; margin: 0 auto; position: relative; z-index: 1; }

        header { text-align: center; margin-bottom: 3rem; }
        .logo-container {
            background: white;
            padding: 1.8rem 2.5rem;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            display: inline-block;
            margin-bottom: 1.5rem;
        }
        .logo { font-size: 3.2rem; font-weight: 700; color: var(--goline-teal); letter-spacing: -0.02em; }
        h1 { font-size: 2.1rem; margin: 0.8rem 0 0.4rem; color: var(--goline-teal); }
        .subtitle { color: var(--gray); font-size: 1.1rem; max-width: 580px; margin: 0 auto; }

        .card {
            background: white;
            border-radius: 20px;
            padding: 2.8rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--goline-teal);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        .section-number {
            width: 28px; height: 28px;
            background: var(--goline-teal);
            color: white;
            border-radius: 50%;
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.6rem;
            color: #334155;
        }
        .required::after { content:"*"; color:var(--error); margin-left:0.3rem; }

        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 0.95rem 1.3rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1.05rem;
            background: #fdfefe;
            transition: all 0.2s ease;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--goline-teal);
            box-shadow: 0 0 0 4px rgba(13,149,168,0.12);
            background: white;
        }
        input.error, textarea.error { border-color: var(--error); }
        .error-message {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 0.4rem;
            display: none;
        }
        .error-message.show { display: block; }

        .checkbox-group {
            display: grid;
            gap: 0.9rem;
            margin-top: 0.8rem;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.3rem;
            background: #f9fafb;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .checkbox-item:hover { border-color: var(--goline-teal); background: white; }
        .checkbox-item.checked {
            border-color: var(--goline-teal);
            background: rgba(13,149,168,0.04);
        }
        .checkbox-item input[type="checkbox"] {
            width: 22px; height: 22px;
            margin-right: 1rem;
            accent-color: var(--goline-teal);
        }
        .checkbox-item label { margin:0; cursor:pointer; font-weight:500; }

        .report-inputs { display: grid; gap: 1.1rem; margin-top: 1rem; }
        .report-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .report-number {
            flex: 0 0 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--goline-teal), var(--goline-accent));
            color: white;
            border-radius: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .report-counter {
            text-align: center;
            padding: 0.8rem;
            border-radius: 10px;
            font-weight: 600;
            margin: 0.8rem 0 1.2rem;
        }
        .report-counter.good  { background: rgba(16,185,129,0.1); color: var(--success); }
        .report-counter.medium{ background: rgba(245,158,11,0.1); color: var(--warning); }

        .submit-area {
            margin-top: 2.5rem;
            text-align: center;
        }
        button.primary {
            background: linear-gradient(135deg, var(--goline-teal), var(--goline-accent));
            color: white;
            border: none;
            padding: 1.1rem 2.8rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            min-width: 240px;
        }
        button.primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        button.primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .loading::after {
            content: '';
            display: inline-block;
            width: 18px; height: 18px;
            margin-left: 10px;
            border: 3px solid rgba(255,255,255,0.4);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
        }

        .success-screen {
            display: none;
            text-align: center;
            padding: 4rem 1.5rem;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
        }
        .success-screen h2 { color: var(--success); font-size: 2.2rem; margin-bottom: 1rem; }

        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 640px) {
            .card { padding: 2rem 1.4rem; }
            h1 { font-size: 1.7rem; }
            .logo { font-size: 2.6rem; }
            button.primary { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo-container">
            <div class="logo">goline</div>
            <p style="color:var(--gray); font-size:1.1rem; margin-top:0.3rem;">IT Services</p>
        </div>
        <h1>Questionario Report QlikView</h1>
        <p class="subtitle">Indicaci i 5 report più importanti per il tuo reparto<br>che verranno prioritizzati nella migrazione a Power BI</p>
    </header>

    <div class="card" id="formContainer">
        <form id="questionarioForm" novalidate>

            <!-- 1. Dati personali -->
            <div class="section-title"><span class="section-number">1</span> Chi sei</div>
            <div style="display:grid; gap:1.4rem; grid-template-columns:1fr 1fr;">
                <div>
                    <label class="required">Nome</label>
                    <input type="text" id="nome" required>
                    <div class="error-message" id="err-nome">Campo obbligatorio</div>
                </div>
                <div>
                    <label class="required">Cognome</label>
                    <input type="text" id="cognome" required>
                    <div class="error-message" id="err-cognome">Campo obbligatorio</div>
                </div>
            </div>

            <!-- 2. Email -->
            <div style="margin-top:2.2rem;">
                <div class="section-title"><span class="section-number">2</span> Contatto</div>
                <label class="required">Email aziendale</label>
                <input type="email" id="email" required>
                <div class="error-message" id="err-email">Email non valida</div>
            </div>

            <!-- 3. Reparti -->
            <div style="margin-top:2.5rem;">
                <div class="section-title"><span class="section-number">3</span> Reparti di competenza</div>
                <p style="color:var(--gray); margin-bottom:1rem;">Seleziona tutti i reparti in cui operi o per cui sei responsabile</p>
                <div class="checkbox-group" id="reparti">
                    <div class="checkbox-item"><input type="checkbox" value="Dispo BAG" id="rb1"><label for="rb1">Dispo BAG</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Dispo PF" id="rb2"><label for="rb2">Dispo PF</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Management di Qualità" id="rb3"><label for="rb3">Management di Qualità</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Acquisti/Vendite" id="rb4"><label for="rb4">Acquisti/Vendite</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Direzione" id="rb5"><label for="rb5">Direzione</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Logistica" id="rb6"><label for="rb6">Logistica</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Trasporti" id="rb7"><label for="rb7">Trasporti</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Controllo entrata merci" id="rb8"><label for="rb8">Controllo entrata merci</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Amministrazione" id="rb9"><label for="rb9">Amministrazione</label></div>
                    <div class="checkbox-item"><input type="checkbox" value="Altro" id="rb-altro"><label for="rb-altro">Altro</label></div>
                </div>
                <div class="error-message" id="err-reparti" style="margin-top:0.8rem;">Seleziona almeno un reparto</div>

                <div id="altro-wrapper" style="margin-top:1.2rem; display:none;">
                    <label>Specifica altro reparto</label>
                    <input type="text" id="altro-reparto">
                </div>
            </div>

            <!-- 4. Report -->
            <div style="margin-top:2.8rem;">
                <div class="section-title"><span class="section-number">4</span> Top report QlikView</div>
                <p style="color:var(--gray); margin-bottom:1rem;">Indica i nomi dei report più utilizzati / strategici (in ordine di priorità)</p>

                <div class="report-counter" id="counter">0 / 5 report inseriti</div>

                <div class="report-inputs">
                    <div class="report-row"><div class="report-number">1</div><input type="text" id="r1" placeholder="Report più importante…"></div>
                    <div class="report-row"><div class="report-number">2</div><input type="text" id="r2" placeholder="Secondo report…"></div>
                    <div class="report-row"><div class="report-number">3</div><input type="text" id="r3" placeholder="Terzo report…"></div>
                    <div class="report-row"><div class="report-number">4</div><input type="text" id="r4" placeholder="Quarto report…"></div>
                    <div class="report-row"><div class="report-number">5</div><input type="text" id="r5" placeholder="Quinto report…"></div>
                </div>
                <div class="error-message" id="err-report">Inserisci almeno un report</div>
            </div>

            <!-- 5. Note -->
            <div style="margin-top:2.8rem;">
                <div class="section-title"><span class="section-number">5</span> Note aggiuntive</div>
                <textarea id="note" rows="5" placeholder="Eventuali commenti, urgenze, problemi noti, richieste particolari…"></textarea>
            </div>

            <div class="submit-area">
                <button type="submit" class="primary" id="btnSubmit">Invia Questionario</button>
            </div>

        </form>
    </div>

    <div class="success-screen" id="successScreen">
        <h2>✓ Inviato con successo!</h2>
        <p style="margin:1.5rem 0; color:var(--gray); font-size:1.1rem;">
            Grazie per la tua collaborazione.<br>
            Le informazioni che hai fornito saranno molto utili per pianificare la migrazione.
        </p>
    </div>
</div>

<script>
const form          = document.getElementById('questionarioForm');
const btnSubmit     = document.getElementById('btnSubmit');
const successScreen = document.getElementById('successScreen');
const formContainer = document.getElementById('formContainer');
const counterEl     = document.getElementById('counter');

const altroChk      = document.getElementById('rb-altro');
const altroWrapper  = document.getElementById('altro-wrapper');

// Mostra/nasconde campo Altro
altroChk.addEventListener('change', () => {
    altroWrapper.style.display = altroChk.checked ? 'block' : 'none';
    if (!altroChk.checked) document.getElementById('altro-reparto').value = '';
});

// Aggiorna contatore report
function updateCounter() {
    let count = 0;
    for (let i=1; i<=5; i++) {
        if (document.getElementById('r'+i).value.trim()) count++;
    }
    counterEl.textContent = count + ' / 5 report inseriti';
    counterEl.className = 'report-counter ' + (count >= 3 ? 'good' : count >= 1 ? 'medium' : '');
}
document.querySelectorAll('#r1,#r2,#r3,#r4,#r5').forEach(el => el.addEventListener('input', updateCounter));
updateCounter();

// Validazione semplice
function validate() {
    let valid = true;
    const clearErr = id => document.getElementById(id)?.classList.remove('show');

    // Nome, Cognome, Email
    ['nome','cognome','email'].forEach(f => {
        const field = document.getElementById(f);
        const err   = document.getElementById('err-'+f);
        if (!field.value.trim()) {
            field.classList.add('error');
            err?.classList.add('show');
            valid = false;
        } else {
            field.classList.remove('error');
            clearErr('err-'+f);
        }
    });

    // Email format
    const email = document.getElementById('email');
    if (email.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
        email.classList.add('error');
        document.getElementById('err-email').classList.add('show');
        valid = false;
    }

    // Almeno un reparto
    const repartiChecked = document.querySelectorAll('#reparti input:checked').length;
    if (repartiChecked === 0) {
        document.getElementById('err-reparti').classList.add('show');
        valid = false;
    } else {
        document.getElementById('err-reparti').classList.remove('show');
    }

    // Almeno un report
    let reportCount = 0;
    for (let i=1; i<=5; i++) {
        if (document.getElementById('r'+i).value.trim()) reportCount++;
    }
    if (reportCount === 0) {
        document.getElementById('err-report').classList.add('show');
        valid = false;
    } else {
        document.getElementById('err-report').classList.remove('show');
    }

    if (!valid) {
        form.querySelector('.error, .error-message.show')?.scrollIntoView({behavior:'smooth', block:'center'});
    }

    return valid;
}

form.addEventListener('submit', async e => {
    e.preventDefault();
    if (!validate()) return;

    btnSubmit.disabled = true;
    btnSubmit.classList.add('loading');
    btnSubmit.textContent = 'Invio in corso…';

    const data = {
        nome:       document.getElementById('nome').value.trim(),
        cognome:    document.getElementById('cognome').value.trim(),
        email:      document.getElementById('email').value.trim(),
        reparti:    Array.from(document.querySelectorAll('#reparti input:checked')).map(cb => cb.value),
        altroReparto: altroChk.checked ? document.getElementById('altro-reparto').value.trim() : '',
        reports:    [
            document.getElementById('r1').value.trim(),
            document.getElementById('r2').value.trim(),
            document.getElementById('r3').value.trim(),
            document.getElementById('r4').value.trim(),
            document.getElementById('r5').value.trim()
        ].filter(Boolean),
        note:       document.getElementById('note').value.trim()
    };

    try {
        const res = await fetch('https://script.google.com/macros/s/AKfycby5Hbf3kGCDOujg4HmP_NUBOkx9pjo9UIfccWMG_m042bVTOQQV9UBYFxjNQ_U5FUiCnA/exec', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data),
            redirect: 'follow'
        });

        if (!res.ok) throw new Error('Risposta non valida');

        const result = await res.json();

        if (result.status === 'success') {
            formContainer.style.display = 'none';
            successScreen.style.display = 'block';
            window.scrollTo({top:0, behavior:'smooth'});
        } else {
            alert('Errore durante il salvataggio:\n' + (result.message || 'Risposta non valida'));
        }
    } catch (err) {
        console.error(err);
        alert('Si è verificato un problema di connessione.\nRiprova più tardi o controlla la tua connessione.');
    } finally {
        btnSubmit.disabled = false;
        btnSubmit.classList.remove('loading');
        btnSubmit.textContent = 'Invia Questionario';
    }
});
</script>
</body>
</html>
